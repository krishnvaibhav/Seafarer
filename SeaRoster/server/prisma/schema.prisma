// c:\Users\krish\.gemini\antigravity\scratch\Seafarer\SeaRoster\server\prisma\schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hashed
  name      String
  role      String   // ADMIN, DEPT_HEAD, CREW
  department String? // DECK, ENGINE, CATERING
  crewMember CrewMember?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CrewMember {
  id        String   @id @default(uuid())
  userId    String?  @unique
  user      User?    @relation(fields: [userId], references: [id])
  firstName String
  lastName  String
  rank      String
  department String
  dailyLogs DailyLog[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DailyLog {
  id              String   @id @default(uuid())
  crewId          String
  crewMember      CrewMember @relation(fields: [crewId], references: [id])
  date            String   // YYYY-MM-DD
  grid            String   // 48 chars: R=Rest, W=Work
  isSignedByCrew  Boolean  @default(false)
  isSignedByMaster Boolean @default(false)
  remarks         String?
  updatedAt       DateTime @updatedAt // Critical for sync
  
  @@unique([crewId, date])
}

model ScheduleTemplate {
  id          String @id @default(uuid())
  name        String // e.g., "4/8 Watch"
  grid        String
  department  String?
}
